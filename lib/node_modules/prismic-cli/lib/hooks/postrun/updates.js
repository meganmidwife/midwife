"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const semver = require("semver");
const axios_1 = require("axios");
const libnpmconfig = require('libnpmconfig');
const hook = async function (opts) {
    const npmconfig = libnpmconfig.read();
    const registry = npmconfig.registry || 'https://registry.npmjs.org/';
    const { name, version } = opts.config.pjson;
    const remoteVersionUrl = new URL(registry);
    remoteVersionUrl.pathname = name;
    return axios_1.default.get(remoteVersionUrl.toString(), { headers: { Accept: 'application/vnd.npm.install-v1+json' } })
        .then(res => res.data['dist-tags'].latest)
        .then(latest => {
        if (semver.lt(version, latest)) {
            // eslint-disable-next-line no-console
            console.info(`A new version of ${name} is available!`);
            // eslint-disable-next-line no-console
            console.info(`Update now by running "npm install -g ${name}"`);
        }
    })
        .catch(() => ({}));
};
exports.default = hook;
