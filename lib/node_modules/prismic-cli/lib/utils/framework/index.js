"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = exports.detect = void 0;
const path = require("path");
const fs = require("fs");
const project_types_1 = require("./project-types");
const hasDependency = (packageJson, name) => Boolean(packageJson.dependencies && packageJson.dependencies[name]) || Boolean(packageJson.devDependencies && packageJson.devDependencies[name]);
const hasPeerDependency = (packageJson, name) => Boolean(packageJson.peerDependencies && packageJson.peerDependencies[name]);
const getFrameworkPreset = (packageJson, framework) => {
    const matcher = {
        dependencies: [false],
        peerDependencies: [false],
        files: [false],
    };
    const { preset, files, dependencies, peerDependencies, matcherFunction, } = framework;
    if (Array.isArray(dependencies) && dependencies.length > 0) {
        matcher.dependencies = dependencies.map(name => hasDependency(packageJson, name));
    }
    if (Array.isArray(peerDependencies) && peerDependencies.length > 0) {
        matcher.peerDependencies = peerDependencies.map(name => hasPeerDependency(packageJson, name));
    }
    if (Array.isArray(files) && files.length > 0) {
        matcher.files = files.map(name => fs.existsSync(path.join(process.cwd(), name)));
    }
    return matcherFunction(matcher) ? preset : null;
};
function detect(pkgJson) {
    const result = project_types_1.supportedProjects.find((framework) => getFrameworkPreset(pkgJson, framework) !== null);
    return result ? result.preset : null;
}
exports.detect = detect;
exports.parse = project_types_1.findProjectType;
